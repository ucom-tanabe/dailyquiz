<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>デイリークイズ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6; /* 前回と同じ背景色 */
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* 上部に寄せる */
            min-height: 100vh;
        }
        .quiz-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            box-sizing: border-box;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        #title-page {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            /* border-bottom: 1px solid #eee; */ /* 必要ならコメント解除 */
        }
        #title-page h2 {
            font-size: 1.8em;
            color: #34495e;
            margin-bottom: 25px;
        }
        #title-page p { /* めんそ～れ～♪ のスタイル */
            font-size: 1.5em;
            color: #28a745; /* 緑色で少し目立たせる */
            font-weight: bold;
            margin-top: -15px; /* h2との間隔を調整 */
            margin-bottom: 30px;
        }
        #start-quiz-btn {
            background-color: #3498db;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        #start-quiz-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        .question-block {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
            display: none; /* JavaScriptで表示を制御 */
        }
        .question-block:last-of-type {
            border-bottom: none;
        }
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            font-weight: bold;
            color: #34495e;
        }
        .answer-option {
            background-color: #ecf0f1; /* 前回と同じ選択肢の背景色 */
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, border 0.3s ease;
            border: 2px solid transparent; /* 境界線を透明で確保 */
        }
        .answer-option:hover {
            background-color: #dfe6e9; /* 前回と同じホバー色 */
            transform: translateY(-2px);
        }
        /* 選択された選択肢のスタイル */
        .answer-option.selected {
            border-color: #3498db; /* 選択時のボーダー色 */
            background-color: #d8edf7; /* 薄い青 */
        }
        /* 正解の選択肢のスタイル */
        .answer-option.correct {
            background-color: #d4edda; /* 薄い緑 */
            border-color: #28a745; /* 緑のボーダー */
            color: #155724;
            font-weight: bold;
        }
        /* 不正解の選択肢のスタイル */
        .answer-option.incorrect {
            background-color: #f8d7da; /* 薄い赤 */
            border-color: #dc3545; /* 赤のボーダー */
            color: #721c24;
            font-weight: bold;
        }
        .mark {
            font-size: 1.5em;
            margin-left: 10px;
            font-weight: bold;
            display: none; /* JavaScriptで表示を制御 */
        }
        .correct-mark {
            color: #28a745; /* 緑色 */
        }
        .incorrect-mark {
            color: #dc3545; /* 赤色 */
        }
        .rationale {
            background-color: #f9f9f9;
            border-left: 5px solid #3498db;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.95em;
            color: #555;
            display: none; /* JavaScriptで表示を制御 */
        }
        .button {
            display: block;
            width: fit-content;
            margin: 20px auto 0;
            padding: 12px 25px;
            background-color: #3498db; /* 前回と同じボタン色 */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .button:hover {
            background-color: #2980b9; /* 前回と同じボタンホバー色 */
            transform: translateY(-1px);
        }
        #quiz-score-area {
            text-align: center;
            margin-top: 30px;
            display: none; /* JavaScriptで表示を制御 */
        }
        #quiz-score {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        #score-message {
            font-size: 1.2em;
            color: #34495e;
            margin-bottom: 15px;
        }
        #challenge-count {
            font-size: 1em;
            color: #666;
            margin-bottom: 20px;
        }
        #restart-quiz-btn {
            background-color: #2ecc71; /* 緑色 */
        }
        #restart-quiz-btn:hover {
            background-color: #27ae60;
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1>福祉用具専門相談員向け 基礎クイズ</h1>

        <div id="title-page">
            <h2>あなたの知識を試しましょう！</h2>
            <p>めんそ～れ～♪</p> {/* ここに「めんそ～れ～♪」を追加 */}
            <button class="button" id="start-quiz-btn">クイズを始める</button>
        </div>

        <div class="question-block" id="question1">
            <div class="question-text">Q1: 福祉用具専門相談員として、利用者に福祉用具を適切に提供するために最も重要な心構えは何ですか？</div>
            <div class="answer-option" data-correct="true">利用者の身体状況や生活環境の変化に合わせて、定期的に用具を見直す</div>
            <div class="answer-option" data-correct="false">一度選定した用具は、特別な事情がない限り変更しない</div>
            <div class="answer-option" data-correct="false">用具の機能や操作方法のみを説明し、利用者の意見は重視しない</div>
            <span class="mark correct-mark">〇</span>
            <span class="mark incorrect-mark">✕</span>
            <div class="rationale">
                **解説:** 福祉用具は利用者の状態や生活環境に合わせた最適なものである必要があるため、定期的な見直しは重要です。利用者の状況は常に変化するため、一度選定した用具であっても柔軟に見直すことが求められます。利用者の意見や希望は用具選定において非常に重要であり、それを無視することは適切な支援とは言えません。
            </div>
            <button class="button next-question-btn">次の問題へ</button>
        </div>

        <div class="question-block" id="question2">
            <div class="question-text">Q2: 介護保険制度における「特定福祉用具販売」の対象となるのは、次のうちどれですか？</div>
            <div class="answer-option" data-correct="true">入浴用いす、簡易浴槽、移動用リフトのつり具部分</div>
            <div class="answer-option" data-correct="false">特殊寝台、車いす、歩行器</div>
            <div class="answer-option" data-correct="false">オムツ、栄養補助食品、ストーマ装具</div>
            <span class="mark correct-mark">〇</span>
            <span class="mark incorrect-mark">✕</span>
            <div class="rationale">
                **解説:** これらは介護保険制度における特定福祉用具販売の対象品目であり、購入が可能です。特殊寝台、車いす、歩行器は原則として福祉用具貸与の対象です。オムツ、栄養補助食品、ストーマ装具は特定福祉用具販売の対象ではありません。
            </div>
            <button class="button next-question-btn">次の問題へ</button>
        </div>

        <div class="question-block" id="question3">
            <div class="question-text">Q3: 特定福祉用具販売における支給限度額について、正しい説明はどれですか？</div>
            <div class="answer-option" data-correct="true">年度ごとに定められた支給限度基準額（通常10万円）が設定されており、それを超える額は全額自己負担となる</div>
            <div class="answer-option" data-correct="false">購入費には上限がなく、必要な福祉用具であれば何点でも購入可能である</div>
            <div class="answer-option" data-correct="false">購入費の支給は一生涯に一度のみであり、再購入は認められない</div>
            <span class="mark correct-mark">〇</span>
            <span class="mark incorrect-mark">✕</span>
            <div class="rationale">
                **解説:** 特定福祉用具販売には年間支給限度基準額が設定されており、この範囲内で保険給付が受けられます。介護保険の特定福祉用具販売には支給限度額が定められており、一生涯に一度という制限もありません。
            </div>
            <button class="button score-quiz-btn">採点する</button> {/* 最後の問題は採点ボタン */}
        </div>

        <div id="quiz-score-area">
            <div id="quiz-score"></div>
            <div id="score-message"></div>
            <div id="challenge-count"></div>
            <button class="button" id="restart-quiz-btn">もう一度挑戦する</button>
        </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const titlePage = document.getElementById('title-page');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const questions = document.querySelectorAll('.question-block');
        let currentQuestionIndex = 0;
        let score = 0;
        let challengeCounter = parseInt(localStorage.getItem('quizChallengeCount') || '0');

        // クイズ開始関数
        function startQuiz() {
            titlePage.style.display = 'none'; // 表紙を非表示
            resetQuiz(false); // クイズをリセットして開始 (初回挑戦としてカウント)
        }

        function showQuestion(index) {
            questions.forEach((q, i) => {
                q.style.display = (i === index) ? 'block' : 'none';
            });
            if (index < questions.length) {
                updateNavigationButtons(false); // Hide next/score initially
            }
        }

        function updateNavigationButtons(answerGiven) {
            const currentQuestionBlock = questions[currentQuestionIndex];
            const nextButton = currentQuestionBlock.querySelector('.next-question-btn');
            const scoreButton = currentQuestionBlock.querySelector('.score-quiz-btn');

            if (nextButton) {
                nextButton.style.display = answerGiven && currentQuestionIndex < questions.length - 1 ? 'block' : 'none';
            }
            if (scoreButton) {
                scoreButton.style.display = answerGiven && currentQuestionIndex === questions.length - 1 ? 'block' : 'none';
            }
        }

        function displayScoreMessage(finalScore) {
            const messageElement = document.getElementById('score-message');
            if (!messageElement) return;

            if (finalScore === questions.length) { // 全問正解 (3問)
                messageElement.textContent = "めんそ～れ～♪";
            } else if (finalScore === 2) { // 2問正解
                messageElement.textContent = "もういっちょ♪";
            } else if (finalScore === 1) { // 1問正解
                messageElement.textContent = "どんまい♪";
            } else { // 0問正解
                messageElement.textContent = ""; // 何も表示しない
            }
        }

        // isRestartedFromButton: 「もう一度挑戦する」ボタンから呼ばれたか (挑戦回数カウント用)
        function resetQuiz(isRestartedFromButton = true) {
            currentQuestionIndex = 0;
            score = 0;
            if (isRestartedFromButton) { // 「もう一度挑戦する」ボタンから呼ばれたらカウントアップ
                challengeCounter++;
                localStorage.setItem('quizChallengeCount', challengeCounter.toString()); // ローカルストレージに保存
            } else { // 「クイズを始める」ボタンからの初回開始時
                 if (challengeCounter === 0) { // 初めての訪問なら1回目
                    challengeCounter = 1;
                    localStorage.setItem('quizChallengeCount', challengeCounter.toString());
                }
                // それ以外はchallengeCounterはそのまま (前の挑戦が終了していないなど)
            }


            questions.forEach(q => {
                const options = q.querySelectorAll('.answer-option');
                options.forEach(option => {
                    option.classList.remove('selected', 'correct', 'incorrect');
                    option.style.pointerEvents = 'auto'; // Enable clicks
                });
                const rationale = q.querySelector('.rationale');
                if (rationale) rationale.style.display = 'none';

                const correctMark = q.querySelector('.correct-mark');
                const incorrectMark = q.querySelector('.incorrect-mark');
                if (correctMark) correctMark.style.display = 'none';
                if (incorrectMark) incorrectMark.style.display = 'none';

                const nextBtn = q.querySelector('.next-question-btn');
                if (nextBtn) nextBtn.style.display = 'none';
                const scoreBtn = q.querySelector('.score-quiz-btn');
                if (scoreBtn) scoreBtn.style.display = 'none';
            });

            const scoreArea = document.getElementById('quiz-score-area');
            if (scoreArea) scoreArea.style.display = 'none';
            const scoreDisplay = document.getElementById('quiz-score');
            if (scoreDisplay) scoreDisplay.textContent = '';
            const scoreMessage = document.getElementById('score-message');
            if (scoreMessage) scoreMessage.textContent = '';
            const challengeCountDisplay = document.getElementById('challenge-count');
            if (challengeCountDisplay) challengeCountDisplay.textContent = '';

            showQuestion(currentQuestionIndex); // 最初の問題を表示
        }

        // 初期表示：表紙のみを表示し、クイズ問題は非表示
        titlePage.style.display = 'block';
        questions.forEach(q => q.style.display = 'none');
        document.getElementById('quiz-score-area').style.display = 'none';

        // 「クイズを始める」ボタンのイベントリスナー
        if (startQuizBtn) {
            startQuizBtn.addEventListener('click', startQuiz);
        }

        questions.forEach((q, qIndex) => {
            const options = q.querySelectorAll('.answer-option');
            const rationale = q.querySelector('.rationale');
            const correctMark = q.querySelector('.correct-mark');
            const incorrectMark = q.querySelector('.incorrect-mark');

            options.forEach(option => {
                option.addEventListener('click', function() {
                    // Check if question has already been answered
                    if (options[0].style.pointerEvents === 'none') {
                        return;
                    }

                    // Disable all options for this question
                    options.forEach(opt => {
                        opt.style.pointerEvents = 'none';
                    });

                    this.classList.add('selected'); // Highlight selected option

                    const isCorrect = this.dataset.correct === 'true';

                    if (isCorrect) {
                        this.classList.add('correct');
                        if (correctMark) correctMark.style.display = 'inline';
                        score++;
                    } else {
                        this.classList.add('incorrect');
                        if (incorrectMark) incorrectMark.style.display = 'inline';
                        // Highlight the true correct answer if selected was incorrect
                        options.forEach(opt => {
                            if (opt.dataset.correct === 'true') {
                                opt.classList.add('correct');
                            }
                        });
                    }

                    if (rationale) rationale.style.display = 'block';
                    updateNavigationButtons(true);
                });
            });

            const nextButton = q.querySelector('.next-question-btn');
            if (nextButton) {
                nextButton.addEventListener('click', function() {
                    currentQuestionIndex++;
                    if (currentQuestionIndex < questions.length) {
                        showQuestion(currentQuestionIndex);
                    }
                });
            }

            const scoreButton = q.querySelector('.score-quiz-btn');
            if (scoreButton) {
                scoreButton.addEventListener('click', function() {
                    const scoreArea = document.getElementById('quiz-score-area');
                    if (scoreArea) scoreArea.style.display = 'block';

                    const scoreDisplay = document.getElementById('quiz-score');
                    if (scoreDisplay) {
                        scoreDisplay.textContent = `あなたのスコア: ${score} / ${questions.length}`;
                    }
                    displayScoreMessage(score); // スコアに応じたメッセージを表示

                    const challengeCountDisplay = document.getElementById('challenge-count');
                    if (challengeCountDisplay) {
                        challengeCountDisplay.textContent = `${challengeCounter}回目の挑戦です`;
                    }

                    q.style.display = 'none'; // Hide the last question after scoring
                });
            }
        });

        const restartButton = document.getElementById('restart-quiz-btn');
        if (restartButton) {
            restartButton.addEventListener('click', () => resetQuiz(true)); // ボタンからのリセットはtrueを渡す
        }
    });
    </script>
</body>
</html>
