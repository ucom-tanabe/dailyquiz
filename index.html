<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>デイリークイズ</title> {/* タイトルを「デイリークイズ」に変更 */}
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6; /* 前回と同じ背景色 */
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* 上部に寄せる */
            min-height: 100vh;
        }
        .quiz-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            box-sizing: border-box;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        #title-page {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            /* border-bottom: 1px solid #eee; */ /* 必要ならコメント解除 */
        }
        #title-page h2 {
            font-size: 1.8em;
            color: #34495e;
            margin-bottom: 25px;
        }
        /* 表紙のPタグは削除されたため、このスタイルは不要になりますが、念のため残しておきます */
        #title-page p { 
            font-size: 1.5em;
            color: #28a745; 
            font-weight: bold;
            margin-top: -15px; 
            margin-bottom: 30px;
        }
        #start-quiz-btn {
            background-color: #3498db;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        #start-quiz-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        .question-block {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
            display: none; /* JavaScriptで表示を制御 */
        }
        .question-block:last-of-type {
            border-bottom: none;
        }
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            font-weight: bold;
            color: #34495e;
        }
        .answer-option {
            background-color: #ecf0f1; /* 前回と同じ選択肢の背景色 */
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, border 0.3s ease;
            border: 2px solid transparent; /* 境界線を透明で確保 */
        }
        .answer-option:hover {
            background-color: #dfe6e9; /* 前回と同じホバー色 */
            transform: translateY(-2px);
        }
        /* 選択された選択肢のスタイル */
        .answer-option.selected {
            border-color: #3498db; /* 選択時のボーダー色 */
            background-color: #d8edf7; /* 薄い青 */
        }
        /* 正解の選択肢のスタイル */
        .answer-option.correct {
            background-color: #d4edda; /* 薄い緑 */
            border-color: #28a745; /* 緑のボーダー */
            color: #155724;
            font-weight: bold;
        }
        /* 不正解の選択肢のスタイル */
        .answer-option.incorrect {
            background-color: #f8d7da; /* 薄い赤 */
            border-color: #dc3545; /* 赤のボーダー */
            color: #721c24;
            font-weight: bold;
        }
        .mark {
            font-size: 1.5em;
            margin-left: 10px;
            font-weight: bold;
            display: none; /* JavaScriptで表示を制御 */
        }
        .correct-mark {
            color: #28a745; /* 緑色 */
        }
        .incorrect-mark {
            color: #dc3545; /* 赤色 */
        }
        .rationale {
            background-color: #f9f9f9;
            border-left: 5px solid #3498db;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.95em;
            color: #555;
            display: none; /* JavaScriptで表示を制御 */
        }
        .button {
            display: block;
            width: fit-content;
            margin: 20px auto 0;
            padding: 12px 25px;
            background-color: #3498db; /* 前回と同じボタン色 */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .button:hover {
            background-color: #2980b9; /* 前回と同じボタンホバー色 */
            transform: translateY(-1px);
        }
        #quiz-score-area {
            text-align: center;
            margin-top: 30px;
            display: none; /* JavaScriptで表示を制御 */
        }
        #quiz-score {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        #score-message {
            font-size: 1.2em;
            color: #34495e;
            margin-bottom: 15px;
        }
        #challenge-count {
            font-size: 1em;
            color: #666;
            margin-bottom: 20px;
        }
        #restart-quiz-btn {
            background-color: #2ecc71; /* 緑色 */
        }
        #restart-quiz-btn:hover {
            background-color: #27ae60;
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1>福祉用具専門相談員向け 基礎クイズ</h1>

        <div id="title-page">
            <h2>あなたの知識を試しましょう！</h2>
            {/* <p>めんそ～れ～♪</p> */} {/* 「めんそ～れ～♪」の表示をボタンに移動したため、この行はコメントアウトまたは削除 */}
            <button class="button" id="start-quiz-btn">めんそ～れ～♪</button> {/* ボタンのテキストを「めんそ～れ～♪」に変更 */}
        </div>

        <div class="question-block" id="question1">
            <div class="question-text">Q1: 福祉用具専門相談員として、利用者に福祉用具を適切に提供するために最も重要な心構えは何ですか？</div>
            <div class="answer-option" data-correct="true">利用者の身体状況や生活環境の変化に合わせて、定期的に用具を見直す</div>
            <div class="answer-option" data-correct="false">一度選定した用具は、特別な事情がない限り変更しない</div>
            <div class="answer-option" data-correct="false">用具の機能や操作方法のみを説明し、利用者の意見は重視しない</div>
            <span class="mark correct-mark">〇</span>
            <span class="mark incorrect-mark">✕</span>
            <div class="rationale">
                **解説:** 福祉用具は利用者の状態や生活環境に合わせた最適なものである必要があるため、定期的な見直しは重要です。利用者の状況は常に変化するため、一度選定した用具であっても柔軟に見直すことが求められます。利用者の意見や希望は用具選定において非常に重要であり、それを無視することは適切な支援とは言えません。
            </div>
            <button class="button next-question-btn">次の問題へ</button>
        </div>

        <div class="question-block" id="question2">
            <div class="question-text">Q2: 介護保険制度における「特定福祉用具販売」の対象となるのは、次のうちどれですか？</div>
            <div class="answer-option" data-correct="true">入浴用いす、簡易浴槽、移動用リフトのつり具部分</div>
            <div class="answer-option" data-correct="false">特殊寝台、車いす、歩行器</div>
            <div class="answer-option" data-correct="false">オムツ、栄養補助食品、ストーマ装具</div>
            <span class="mark correct-mark">〇</span>
            <span class="mark incorrect-mark">✕</span>
            <div class="rationale">
                **解説:** これらは介護保険制度における特定福祉用具販売の対象品目であり、購入が可能です。特殊寝台、車いす、歩行器は原則として福祉用具貸与の対象です。オムツ、栄養補助食品、ストーマ装具は特定福祉用具販売の対象ではありません。
            </div>
            <button class="button next-question-btn">次の問題へ</button>
        </div>

        <div class="question-block" id="question3">
            <div class="question-text">Q3: 特定福祉用具販売における支給限度額について、正しい説明はどれですか？</div>
            <div class="answer-option" data-correct="true">年度ごとに定められた支給限度基準額（通常10万円）が設定されており、それを超える額は全額自己負担となる</div>
            <div class="answer-option" data-correct="false">購入費には上限がなく、必要な福祉用具であれば何点でも購入可能である</div>
            <div class="answer-option" data-correct="false">購入費の支給は一生涯に一度のみであり、再購入は認められない</div>
            <span class="mark correct-mark">〇</span>
            <span class="mark incorrect-mark">✕</span>
            <div class="rationale">
                **解説:** 特定福祉用具販売には年間支給限度基準額が設定されており、この範囲内で保険給付が受けられます。介護保険の特定福祉用具販売には支給限度額が定められており、一生涯に一度という制限もありません。
            </div>
            <button class="button score-quiz-btn">採点する</button> {/* 最後の問題は採点ボタン */}
        </div>

        <div id="quiz-score-area">
            <div id="quiz-score"></div>
            <div id="score-message"></div>
            <div id="challenge-count"></div>
            <button class="button" id="restart-quiz-btn">もう一度挑戦する</button>
        </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const titlePage = document.getElementById('title-page');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const questions = document.querySelectorAll('.question-block');
        let currentQuestionIndex = 0;
        let score = 0;
        // localStorageから挑戦回数を取得、初回は0とする
        let challengeCounter = parseInt(localStorage.getItem('quizChallengeCount') || '0');

        // クイズ開始関数
        function startQuiz() {
            titlePage.style.display = 'none'; // 表紙を非表示
            resetQuiz(false); // クイズをリセットして開始 (初回挑戦としてカウント)
        }

        // 指定されたインデックスの問題を表示
        function showQuestion(index) {
            questions.forEach((q, i) => {
                q.style.display = (i === index) ? 'block' : 'none';
            });
            // 質問表示後、ボタンの表示状態を更新
            if (index < questions.length) {
                updateNavigationButtons(false); // 回答前なので、次の問題/採点ボタンは非表示
            }
        }

        // ナビゲーションボタン (次の問題へ/採点する) の表示を更新
        function updateNavigationButtons(answerGiven) {
            const currentQuestionBlock = questions[currentQuestionIndex];
            const nextButton = currentQuestionBlock.querySelector('.next-question-btn');
            const scoreButton = currentQuestionBlock.querySelector('.score-quiz-btn');

            // 回答後で、かつ最後の問題でなければ「次の問題へ」を表示
            if (nextButton) {
                nextButton.style.display = answerGiven && currentQuestionIndex < questions.length - 1 ? 'block' : 'none';
            }
            // 回答後で、かつ最後の問題であれば「採点する」を表示
            if (scoreButton) {
                scoreButton.style.display = answerGiven && currentQuestionIndex === questions.length - 1 ? 'block' : 'none';
            }
        }

        // スコアに応じたメッセージを表示
        function displayScoreMessage(finalScore) {
            const messageElement = document.getElementById('score-message');
            if (!messageElement) return;

            if (finalScore === questions.length) { // 全問正解 (3問)
                messageElement.textContent = "めんそ～れ～♪";
            } else if (finalScore === 2) { // 2問正解
                messageElement.textContent = "もういっちょ♪";
            } else if (finalScore === 1) { // 1問正解
                messageElement.textContent = "どんまい♪";
            } else { // 0問正解
                messageElement.textContent = ""; // 何も表示しない
            }
        }

        // クイズの状態をリセット
        // isRestartedFromButton: 「もう一度挑戦する」ボタンから呼ばれたか (挑戦回数カウント用)
        function resetQuiz(isRestartedFromButton = true) {
            currentQuestionIndex = 0;
            score = 0;

            // 挑戦回数の更新
            if (isRestartedFromButton) { // 「もう一度挑戦する」ボタンからのリセット時
                challengeCounter++;
                localStorage.setItem('quizChallengeCount', challengeCounter.toString());
            } else { // 「クイズを始める」ボタンからの開始時 (または初回ロード時)
                 if (challengeCounter === 0) { // 初めてのアクセスなら1回目として設定
                    challengeCounter = 1;
                    localStorage.setItem('quizChallengeCount', challengeCounter.toString());
                }
                // それ以外 (例: 前回終了せずにページを閉じた場合) は、既存のカウントを維持
            }

            // 各問題の状態をリセット
            questions.forEach(q => {
                const options = q.querySelectorAll('.answer-option');
                options.forEach(option => {
                    option.classList.remove('selected', 'correct', 'incorrect');
                    option.style.pointerEvents = 'auto'; // クリック可能に戻す
                });
                const rationale = q.querySelector('.rationale');
                if (rationale) rationale.style.display = 'none'; // 解説を非表示

                const correctMark = q.querySelector('.correct-mark');
                const incorrectMark = q.querySelector('.incorrect-mark');
                if (correctMark) correctMark.style.display = 'none'; // 正誤マークを非表示
                if (incorrectMark) incorrectMark.style.display = 'none';

                const nextBtn = q.querySelector('.next-question-btn');
                if (nextBtn) nextBtn.style.display = 'none'; // 次のボタンを非表示
                const scoreBtn = q.querySelector('.score-quiz-btn');
                if (scoreBtn) scoreBtn.style.display = 'none'; // 採点ボタンを非表示
            });

            // スコア表示エリアをリセット
            const scoreArea = document.getElementById('quiz-score-area');
            if (scoreArea) scoreArea.style.display = 'none';
            const scoreDisplay = document.getElementById('quiz-score');
            if (scoreDisplay) scoreDisplay.textContent = '';
            const scoreMessage = document.getElementById('score-message');
            if (scoreMessage) scoreMessage.textContent = '';
            const challengeCountDisplay = document.getElementById('challenge-count');
            if (challengeCountDisplay) challengeCountDisplay.textContent = ''; // 挑戦回数表示もクリア

            showQuestion(currentQuestionIndex); // 最初の問題を表示
        }

        // ページ読み込み時の初期表示設定
        // まず表紙のみを表示し、クイズ問題と結果エリアは非表示にする
        titlePage.style.display = 'block';
        questions.forEach(q => q.style.display = 'none');
        document.getElementById('quiz-score-area').style.display = 'none';

        // 「クイズを始める」ボタンのイベントリスナー
        if (startQuizBtn) {
            startQuizBtn.addEventListener('click', startQuiz);
        }

        // 各問題ブロックごとの処理
        questions.forEach((q, qIndex) => {
            const options = q.querySelectorAll('.answer-option');
            const rationale = q.querySelector('.rationale');
            const correctMark = q.querySelector('.correct-mark');
            const incorrectMark = q.querySelector('.incorrect-mark');

            // 各選択肢のクリックイベント
            options.forEach(option => {
                option.addEventListener('click', function() {
                    // 既に回答済みの場合は何もしない (再選択不可)
                    if (options[0].style.pointerEvents === 'none') {
                        return;
                    }

                    // この問題の全ての選択肢を無効化 (再選択不可にする)
                    options.forEach(opt => {
                        opt.style.pointerEvents = 'none';
                    });

                    this.classList.add('selected'); // 選択された選択肢をハイライト

                    const isCorrect = this.dataset.correct === 'true';

                    if (isCorrect) {
                        this.classList.add('correct'); // 正解スタイルを適用
                        if (correctMark) correctMark.style.display = 'inline'; // 〇マークを表示
                        score++; // スコア加算
                    } else {
                        this.classList.add('incorrect'); // 不正解スタイルを適用
                        if (incorrectMark) incorrectMark.style.display = 'inline'; // ✕マークを表示
                        // 不正解の場合、正しい選択肢もハイライト
                        options.forEach(opt => {
                            if (opt.dataset.correct === 'true') {
                                opt.classList.add('correct');
                            }
                        });
                    }

                    if (rationale) rationale.style.display = 'block'; // 解説を表示
                    updateNavigationButtons(true); // 回答後のボタン表示を更新
                });
            });

            // 「次の問題へ」ボタンのイベント
            const nextButton = q.querySelector('.next-question-btn');
            if (nextButton) {
                nextButton.addEventListener('click', function() {
                    currentQuestionIndex++; // 次の問題へ
                    if (currentQuestionIndex < questions.length) {
                        showQuestion(currentQuestionIndex); // 次の問題を表示
                    }
                });
            }

            // 「採点する」ボタンのイベント (最終問題のみ)
            const scoreButton = q.querySelector('.score-quiz-btn');
            if (scoreButton) {
                scoreButton.addEventListener('click', function() {
                    const scoreArea = document.getElementById('quiz-score-area');
                    if (scoreArea) scoreArea.style.display = 'block'; // スコアエリアを表示

                    const scoreDisplay = document.getElementById('quiz-score');
                    if (scoreDisplay) {
                        scoreDisplay.textContent = `あなたのスコア: ${score} / ${questions.length}`;
                    }
                    displayScoreMessage(score); // スコアに応じたメッセージを表示

                    const challengeCountDisplay = document.getElementById('challenge-count');
                    if (challengeCountDisplay) {
                        // 初回起動時の挑戦回数と一致するように調整
                        challengeCountDisplay.textContent = `${challengeCounter}回目の挑戦です`;
                    }

                    q.style.display = 'none'; // 最後の問題ブロックを非表示
                });
            }
        });

        // 「もう一度挑戦する」ボタンのイベント
        const restartButton = document.getElementById('restart-quiz-btn');
        if (restartButton) {
            restartButton.addEventListener('click', () => resetQuiz(true)); // ボタンからのリセットはtrueを渡す
        }
    });
    </script>
</body>
</html>
